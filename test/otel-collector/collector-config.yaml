# OpenTelemetry Collector Configuration for Brokle Integration Testing
# Tested with: otel/opentelemetry-collector-contrib:0.91.0
#
# What this config does:
# - Receives OTLP traces via gRPC (4317) and HTTP (4318)
# - Batches spans for efficient transmission (100 spans or 1 second)
# - Sends to Brokle API with gzip compression and retry logic
# - Exposes health check endpoint on port 13133

receivers:
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

processors:
  batch:
    timeout: 1s
    send_batch_size: 100
    send_batch_max_size: 1000

exporters:
  # Brokle API exporter
  otlphttp/brokle:
    endpoint: http://test-brokle-api:8080  # OTLP exporter auto-appends /v1/traces
    headers:
      X-API-Key: bk_fzwUZlCBIE3Z0QfGnfAIKjZ4DuK4ChJHf3mPnnbV  # Test API key
    compression: gzip
    timeout: 30s
    retry_on_failure:
      enabled: true
      initial_interval: 1s
      max_interval: 30s
      max_elapsed_time: 300s

  # Debug logging (optional, for troubleshooting)
  logging:
    loglevel: info
    sampling_initial: 5
    sampling_thereafter: 200

extensions:
  # Health check extension (available at http://localhost:13133)
  health_check:
    endpoint: 0.0.0.0:13133

service:
  extensions: [health_check]

  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlphttp/brokle, logging]

  telemetry:
    logs:
      level: info
