# Brokle Platform Environment Configuration

# =============================================================================
# APPLICATION MODE
# =============================================================================
# Deployment mode: "server" (API) or "worker" (background processing)
#
# server mode:
#   - Runs HTTP API server on port 8080
#   - Handles database migrations
#   - Requires JWT_SECRET for authentication
#   - Validates all auth configuration
#
# worker mode:
#   - Runs background telemetry processing
#   - No HTTP server
#   - No migrations
#   - No JWT_SECRET needed
#
# Default: server
APP_MODE=server

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================
APP_NAME=Brokle
ENV=development
LOG_LEVEL=debug
LOG_FORMAT=text
PORT=8080

# =============================================================================
# gRPC OTLP CONFIGURATION (OpenTelemetry Protocol)
# =============================================================================
# gRPC OTLP endpoint on industry standard port 4317
# Enables zero-config setup for Go/Java/.NET SDKs
GRPC_PORT=4317

# OTLP Preservation (Lossless Export Capability)
# Stores raw OTLP protobuf in JSON format for vendor migration
# Storage overhead: ~10-15% (ZSTD compressed)
# Default: true (enables /v1/traces/export endpoint)
OTLP_PRESERVE_RAW=true

# =============================================================================
# DATABASE CONFIGURATION (Recommended: Use *_URL variables)
# =============================================================================

# PostgreSQL (Primary Database) - RECOMMENDED: Single URL approach
DATABASE_URL=postgres://brokle:brokle_password@localhost:5432/brokle_dev?sslmode=disable

# PostgreSQL Migration Settings
DATABASE_AUTO_MIGRATE=false
DATABASE_MIGRATIONS_PATH=./migrations/postgres

# PostgreSQL - ALTERNATIVE: Individual fields (for Docker/K8s/CI environments)
# POSTGRES_HOST=localhost
# POSTGRES_PORT=5432
# POSTGRES_USER=brokle
# POSTGRES_PASSWORD=brokle_password
# POSTGRES_DB=brokle_dev
# POSTGRES_SSL_MODE=disable

# ClickHouse (Analytics Database) - RECOMMENDED: Single URL approach
CLICKHOUSE_URL=clickhouse://brokle:brokle_password@localhost:9000/default

# ClickHouse Migration Settings
CLICKHOUSE_MIGRATIONS_PATH=./migrations/clickhouse
CLICKHOUSE_MIGRATIONS_TABLE=schema_migrations
CLICKHOUSE_MIGRATIONS_ENGINE=MergeTree

# ClickHouse - ALTERNATIVE: Individual fields (for Docker/K8s/CI environments)
# CLICKHOUSE_HOST=localhost
# CLICKHOUSE_PORT=8123
CLICKHOUSE_USER=brokle
# CLICKHOUSE_PASSWORD=brokle_password
# CLICKHOUSE_DB=default

# Redis (Cache & Sessions) - RECOMMENDED: Single URL approach
REDIS_URL=redis://localhost:6379/0

# Redis - ALTERNATIVE: Individual fields (for Docker/K8s/CI environments)
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_PASSWORD=
# REDIS_DB=0

# =============================================================================
# AUTHENTICATION & SECURITY (New Smart JWT Configuration)
# =============================================================================

# Token Configuration (Go duration format: ns, us, ms, s, m, h)
ACCESS_TOKEN_TTL=15m
REFRESH_TOKEN_TTL=168h
TOKEN_ROTATION_ENABLED=true

# Rate Limiting Configuration
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_IP=100
RATE_LIMIT_PER_USER=1000
RATE_LIMIT_WINDOW=1h

# JWT Security - Flexible Method (HS256 for dev, RS256 for prod)
JWT_SIGNING_METHOD=HS256
JWT_ISSUER=brokle

# HS256 (Development/Simple deployments) - REQUIRED for HS256
JWT_SECRET=your-super-secret-jwt-key-at-least-32-chars-for-security

# RS256 (Production/Enterprise) - Use either file paths OR base64 keys
# JWT_PRIVATE_KEY_PATH=/path/to/jwt/private.pem
# JWT_PUBLIC_KEY_PATH=/path/to/jwt/public.pem
# JWT_PRIVATE_KEY_BASE64=<base64-encoded-private-key>
# JWT_PUBLIC_KEY_BASE64=<base64-encoded-public-key>

# JWT token TTL is now configured above as ACCESS_TOKEN_TTL and REFRESH_TOKEN_TTL
API_KEY_PREFIX=bk_
BCRYPT_COST=12

# Session configuration
SESSION_SECRET=your-session-secret-key-change-in-production
SESSION_TIMEOUT=7d

# OAuth Configuration (Google/GitHub Signup)
# Get Google OAuth credentials: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_REDIRECT_URL=http://localhost:8080/api/v1/auth/google/callback

# Get GitHub OAuth credentials: https://github.com/settings/developers
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
GITHUB_REDIRECT_URL=http://localhost:8080/api/v1/auth/github/callback

# CORS Configuration
# Comma-separated list, no spaces. Use "*" for all origins in development
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001,https://yourdomain.com
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS,PATCH
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-API-Key

# Cookie domain for cross-subdomain auth (e.g., ".brokle.com")
# Empty = use request host (single domain only)
# Set to ".example.com" to share cookies between app.example.com and example.com
COOKIE_DOMAIN=

# =============================================================================
# ENCRYPTION (User-Provided Credentials)
# =============================================================================
# AI Provider Credential Encryption Key (AES-256-GCM)
# Required for storing user-provided AI API keys in playground
# Generate with: openssl rand -base64 32
# SECURITY: Store in secrets manager in production (GCP Secret Manager, AWS Secrets Manager)
AI_KEY_ENCRYPTION_KEY=your-base64-encoded-32-byte-encryption-key-change-in-production

# Business & Billing APIs - Standard naming convention
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
STRIPE_PUBLISHABLE_KEY=pk_test_your-stripe-publishable-key
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# =============================================================================
# MONITORING & OBSERVABILITY
# =============================================================================
# Prometheus metrics
METRICS_ENABLED=true
METRICS_PORT=9100

# Grafana
GRAFANA_ADMIN_PASSWORD=admin
GRAFANA_SECRET_KEY=your-grafana-secret-key
GRAFANA_ROOT_URL=http://localhost:3001

# Alertmanager
ALERT_WEBHOOK_URL=
SLACK_WEBHOOK_URL=
EMAIL_ALERTS_ENABLED=false

# =============================================================================
# EMAIL CONFIGURATION (Transactional Emails)
# =============================================================================
# Email provider options: resend, smtp, ses, sendgrid
# Leave empty to disable email functionality (invitations will still be created but not sent)
EMAIL_PROVIDER=resend

# Common email settings (required for all providers)
EMAIL_FROM_ADDRESS=notifications@yourdomain.com
EMAIL_FROM_NAME=Brokle

# -----------------------------------------------------------------------------
# RESEND PROVIDER (Recommended - https://resend.com)
# -----------------------------------------------------------------------------
# Get your API key at: https://resend.com/api-keys
RESEND_API_KEY=re_your_resend_api_key_here

# -----------------------------------------------------------------------------
# SMTP PROVIDER (Generic SMTP server)
# -----------------------------------------------------------------------------
# Uncomment and set EMAIL_PROVIDER=smtp to use
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USERNAME=your-smtp-username
# SMTP_PASSWORD=your-smtp-password
# SMTP_USE_TLS=true

# -----------------------------------------------------------------------------
# AWS SES PROVIDER (Amazon Simple Email Service)
# -----------------------------------------------------------------------------
# Uncomment and set EMAIL_PROVIDER=ses to use
# Uses AWS default credential chain if access keys not provided
# (IAM role, environment, credentials file, etc.)
# SES_REGION=us-east-1
# SES_ACCESS_KEY=your-aws-access-key-id      # Optional - uses default chain
# SES_SECRET_KEY=your-aws-secret-access-key  # Optional - uses default chain

# -----------------------------------------------------------------------------
# SENDGRID PROVIDER (https://sendgrid.com)
# -----------------------------------------------------------------------------
# Uncomment and set EMAIL_PROVIDER=sendgrid to use
# Get your API key at: https://app.sendgrid.com/settings/api_keys
# SENDGRID_API_KEY=SG.your_sendgrid_api_key_here

# =============================================================================
# FEATURE FLAGS
# =============================================================================
ENABLE_WEBSOCKETS=true
ENABLE_SEMANTIC_CACHING=true
ENABLE_REQUEST_LOGGING=true
ENABLE_COST_TRACKING=true
ENABLE_QUALITY_SCORING=true
ENABLE_AI_ROUTING=true

# =============================================================================
# CACHING CONFIGURATION
# =============================================================================
CACHE_TTL_DEFAULT=300
CACHE_TTL_SEMANTIC=3600
SEMANTIC_SIMILARITY_THRESHOLD=0.95
CACHE_MAX_SIZE=1000

# Rate limiting is configured in the AUTHENTICATION & SECURITY section above

# =============================================================================
# AI ROUTING CONFIGURATION
# =============================================================================
ROUTING_STRATEGY=performance
ROUTING_HEALTH_CHECK_INTERVAL=30s
ROUTING_TIMEOUT=30s
ROUTING_RETRY_ATTEMPTS=3

# =============================================================================
# COST TRACKING
# =============================================================================
COST_TRACKING_ENABLED=true
COST_ALERT_THRESHOLD=100.00
MONTHLY_BUDGET_LIMIT=1000.00

# =============================================================================
# APPLICATION URL (Backend)
# =============================================================================
# Base URL for the frontend application (used for invitation links, etc.)
APP_URL=http://localhost:3000

# =============================================================================
# FRONTEND CONFIGURATION
# =============================================================================
NEXT_PUBLIC_API_URL=http://localhost:8080
NEXT_PUBLIC_WS_URL=ws://localhost:8080
NEXT_PUBLIC_APP_URL=http://localhost:3000

# =============================================================================
# DEVELOPMENT & TESTING
# =============================================================================
DEBUG_ENABLED=true
TEST_DATABASE_URL=postgres://brokle_test:brokle_test_password@localhost:5433/brokle_test?sslmode=disable

# =============================================================================
# BROKLE-SPECIFIC CONFIGURATION (Use BROKLE_ prefix)
# =============================================================================
# SDK Client Configuration (for applications using Brokle SDKs)
# BROKLE_API_KEY=ak_your_api_key_here
# BROKLE_HOST=http://localhost:8000
# BROKLE_PROJECT_ID=proj_your_project_id
# BROKLE_ENVIRONMENT=production

# Enterprise Features (Only for Business/Enterprise licenses)
# BROKLE_ENTERPRISE_LICENSE_KEY=your-license-key
# BROKLE_ENTERPRISE_LICENSE_TYPE=business
# BROKLE_ENTERPRISE_SSO_ENABLED=true
# BROKLE_ENTERPRISE_SSO_PROVIDER=saml
# BROKLE_ENTERPRISE_RBAC_ENABLED=true
# BROKLE_ENTERPRISE_COMPLIANCE_ENABLED=true
# BROKLE_ENTERPRISE_ANALYTICS_ENABLED=true

# =============================================================================
# PRODUCTION OVERRIDES (Uncomment for production)
# =============================================================================
# ENV=production
# LOG_LEVEL=info
# DEBUG_ENABLED=false
# DATABASE_URL=postgres://user:password@prod-host:5432/brokle_prod?sslmode=require
# CORS_ALLOWED_ORIGINS=https://yourdomain.com
# JWT_SECRET=your-super-secure-production-jwt-secret
# SESSION_SECRET=your-super-secure-production-session-secret
# STRIPE_SECRET_KEY=sk_live_your-live-stripe-key

# Blob Storage Configuration (S3/MinIO)
# Note: LLM input/output data is stored directly in ClickHouse with ZSTD compression for optimal cost and performance.
# Blob storage is available for future features: scheduled exports, media files, raw event storage, etc.
BLOB_STORAGE_PROVIDER=minio
BLOB_STORAGE_BUCKET_NAME=brokle
BLOB_STORAGE_REGION=us-east-1
BLOB_STORAGE_ENDPOINT=http://localhost:9100
BLOB_STORAGE_ACCESS_KEY_ID=minioadmin
BLOB_STORAGE_SECRET_ACCESS_KEY=minioadmin
BLOB_STORAGE_USE_PATH_STYLE=true
# BLOB_STORAGE_THRESHOLD is deprecated (no longer used for auto-offload)
BLOB_STORAGE_THRESHOLD=10000

# ============================================================================
# S3 Raw Telemetry Archive (Parquet + ZSTD)
# ============================================================================
# Archives raw OTLP data to S3 for long-term retention, compliance, and vendor portability.
# Uses Parquet format with ZSTD compression for ~85% size reduction.
# Fire-and-forget pattern - doesn't block ClickHouse writes.
# Uses same bucket as BLOB_STORAGE - separation is via Hive-style path prefix.
ARCHIVE_ENABLED=true
ARCHIVE_PATH_PREFIX=raw-telemetry/
ARCHIVE_COMPRESSION_LEVEL=3
ARCHIVE_DEFAULT_RETENTION_DAYS=2190
